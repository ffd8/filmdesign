<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FILM + DESIGN : Collection Overview</title>
	<style type="text/css">
		@font-face {
			font-family: 'roboto_mono';
			src: url('includes/fonts/robotomono-regular-webfont.woff2') format('woff2'),
			url('includes/fonts/robotomono-regular-webfont.woff') format('woff');
			font-weight: 400;
			font-style: normal;
		}
		*{
			box-sizing: border-box;
			font-family: 'roboto_mono', sans-serif;
			outline: none;
		}
		a{
			text-decoration: none;
			color: #fff;
		}
		a:hover{
			text-decoration: underline;
		}
		body{
			margin: 0;
			background: #222;
		}
		#header{
			color: #fff;
			padding: 15px 0 15px 15px;
			margin-bottom: 15px;
		}
		#header h1{
			margin: 0;
			margin-bottom: 15px;
		}
		.subtext{
			font-size: 11pt;
			line-height: 1.2em;
			column-count: 3;
			padding-right: 25px;
			column-gap:15px;
		}
		.subtext p{
			margin-top: 0;
		}
		#results{
			display: flex;
			flex-flow: row wrap;
			margin-top: 0px;
			border-top: 1px solid #aaa;
			color: #fff;
		}
		.vid{
			position: relative;
			flex: 0 1 calc(20vw - 2px);
			width: calc(20vw - 2px);
			padding: 1px;
			color: #aaa;
			font-size: 10pt;
		}
		.vid video, .vid .vid-poster{
			width: 100%;
		}
		.vid:hover{
			background: #444;
		}
		.info{
			font-size: 9pt;
			padding: 5px;
			height: 75px;
		}
		#loadmore{
			margin: 15px;
			text-align: center;
			width: 25vw;
			height: 25px;
			background: #fff;
			border-radius: 5px;
			margin-left: auto;
		}
		.lazy-exited {
		  opacity: 0
		}
		.link{
			float: right;
			cursor: help;
		}
		svg{
			height: 1.2em;
			margin-bottom: -5px !important;
			padding: 0;
			margin: 0;
			opacity: .75;
		}
		svg:hover{
			opacity: 1;
		}
		.fav svg:hover{
			cursor: pointer;
			fill: white;
		}
		#credits{
			display: none;
		}

		#filter{
			color: #fff;
			padding: 5px 0 5px 15px;
			border-top: 1px solid #aaa;
			margin: 0;
			display: flex;
			flex-direction: row;
		}

		#filter div{
			width: 20vw;
		}
		#filter a{
			cursor: pointer;

		}
		#filter a:hover{
			text-decoration: none;
			font-style: italic;
		}
		#filter a:hover svg{
			fill: #fff;
		}

		#filter input{
			background: none;
			border: 0;
			border-bottom: 2px solid #fff;
			color: #fff;
		}

		#loading{
			display: none;
			position: fixed;
			z-index: 99;
			left: 0vw;
			top: 0vw;
			background: rgba(0, 0, 0, .5);
			width: 100vw;
			height: 100vh;
			font-size: 100pt;
			text-align: center;
			padding-top: 25vh;
			color: #fff;
			animation:request 1s infinite
		}
		@keyframes request {
			0%	 { color: rgba(255, 255, 255, 1) }
			50%	 { color: rgba(255, 255, 255, .25) }
			100% { color: rgba(255, 255, 255, 1) }
		}
		#loadmore{
			border-radius: 0;
			background: #333;
			color: #fff;
			border-top: 1px solid #fff;
			width: 100vw;
			height: 50px;
			padding: 15px;
			cursor: pointer;
		}
		#loadmore:hover{
			background: #444;
		}

		@media only screen and (max-width: 800px) {
			.subtext{
				column-count: 1;
			}
			.vid{
				flex: 0 1 calc(50vw - 2px);
				width: calc(50vw - 2px);
				overflow: hidden;
			}
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.5.0/dist/lazyload.min.js"></script>

</head>
<body>
<div id="loading">LOADING...</div>
<div id="header">
	<h1><a href="https://mediathek.hgk.fhnw.ch/amp/search/zotero2-2545256.3JZWF892" target="_blank">FILM + DESIGN</a></h1>
	<div class="subtext">
		<p>30 Jahre Grundlagen des Films, Filmgrafik und Audiovisuelle Projekte in der Fach- und Weiterbildungsklasse für Grafik der SFG Basel und im Fachbereich Visuelle Kommunikation der HFG Basel. Seit 1968 wurde von Peter von Arx in der Fachklasse und der Weiterbildungsklasse für Grafik der Schule für Gestaltung Basel und ab 1983 im Fachbereich Visuelle Kommunikation der HFG Basel ein Unterricht für Film, Video und audiovisuelle Projekte FILM + DESIGN aufgebaut. Beteiligt waren auch die Dozierenden Max Mathys, Peter Olpe, Gregory Vines, Reinhard Manz und Fabian Kempter. Der Unterricht basierte auf den grundlegenden Phänomenen und Dimensionen des Films, aus denen neue gestalterische Formen entwickelt wurden. (Struktureller Film). Ziel des Projektes ist, die entstandenen Filme digital zu erhalten, um die Unterrichtsmethoden, wie sie im Buch „Film + Design“ von Peter von Arx beschrieben sind, audiovisuell erlebbar und zugänglich zu machen. Der Bereich Film wurde am Institut Visuelle Kommunikation der HGK FHNW bis heute im Schwerpunktfach Medium erhalten und weiterentwickelt.</p>

	<p><a href="https://mediathek.hgk.fhnw.ch/amp/search/zotero2-2545256.3JZWF892" target="_blank">→ View collection on Mediathek HGK FHNW</a></p>
	<p>Usage: <br>
		- Order is shuffled for moments of serendipity <br>
		- Scroll to the bottom to load more <br>
		- Click <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-database"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg> for full details<br>
		- Click <svg class="" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg> to save and view favorites<br>
		- Use <span style="border-bottom:2px solid #fff">  </span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-filter"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg> to filter based on metadata
	</p>
		<span onclick="showCredits(this);" style="cursor:help;">Impressum</span>
	</div>
</div>
<div id="filter">
	<div>
		<a class="fav" onclick="favResults()" title="toggle filtering of favorites">
		<svg id="filter-fav" class="" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
		View Favorites</a>
	</div>
	<div id="filter-search">
		<input id="filter-input" type="text" name="filter-input" placeholder="keywords" onkeyup="inputKey(this)">
		<a onclick="filterResults()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-filter"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg></a>
		<a id="filter-clear" style="display:none;" onclick="filterClear()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></a>
	</div>
	<div id="filter-status"></div>

</div>
<div id="results"></div>
<div id="loadmore" onclick="loadMore()">Load More +</div>
<!-- <div id="loadmore" onclick="loadMore()">Load More</div> -->
<script type="text/javascript">
	let results = [], resultsAll = [], resultsFilter = [],  offset = 0, count = 20, favs = [], filterFavs = false
	let div = {
		filter : {
			search : document.getElementById('filter-search'),
			status : document.getElementById('filter-status'),
			clear : document.getElementById('filter-clear'),
			input : document.getElementById('filter-input'),
			fav : document.getElementById('filter-fav')
		},
		loading: document.getElementById('loading'),
		loadmore: document.getElementById('loadmore')
	}

	var lazyLoadInstance = new LazyLoad({
		callback_loading: function(elm){
			elm.classList.remove("lazy")
		// 	console.log(elm)
		}
		// callback_finish : function(){

		// 	// console.log('done')
		// 	// div.loading.style.display = 'none'
		// 	// if(lazyLoadInstance.loadingCount <= 1){
		// 	// 	div.loading.style.display = 'none'
		// 	// }
		// }
	});

	fetch('includes/data/film_design.json')
	.then(res => res.json())
	.then(jsonObj => {
		shuffleArray(jsonObj.Result.items)
		resultsAll = jsonObj.Result.items // shuffle...
		results = resultsAll.slice()
		addResults()
	})

	window.onscroll = function(ev) {
		if ((window.innerHeight + window.scrollY) >= document.body.scrollHeight) {
		  // you're at the bottom of the page
		  if(offset < (results.length - count)){
			loadMore()
		  }

		}
	};

	function loadMore(){
		offset += count
		addResults()
	}

	function favResults(){
		document.getElementById('results').innerHTML = '';
		results = resultsAll.slice()
		// filterClear()
		filterFavs = !filterFavs
		if(filterFavs){
			for(let r of results){
				if(favs.indexOf(r.Id) != -1){
					parseResult(r)
				}
			}
			div.filter.fav.style.fill = '#fff'
			div.filter.search.style.visibility = 'hidden'
			div.filter.status.style.visibility = 'hidden'
			div.loadmore.style.visibility = 'hidden'
		}else{
			let keyword = div.filter.input.value
			if(keyword == ''){
				addResults()
			}else{
				filterResults()
			}

			div.filter.fav.style.fill = 'none'
			div.filter.search.style.visibility = 'visible'
			div.filter.status.style.visibility = 'visible'
			div.loadmore.style.visibility = 'visible'
		}
		lazyLoadInstance.update();
		favsInit()
	}

	function inputKey(e){
		if(event.key === 'Enter') {
	        filterResults()
	    }
	}

	function filterResults(){
		let keyword = div.filter.input.value
		if(keyword == ''){
			filterClear()
			return false
		}
		div.filter.fav.style.fill = 'none'
		div.filter.clear.style = 'block'
		document.getElementById('results').innerHTML = '';
		offset = 0
		count = 20
		resultsFilter = []
		for(let r of resultsAll){
			let rf = [
				r.Id.toLowerCase(),
				// type: r.type.toLowerCase(),
				r.title.toLowerCase(),
				r.text.toLowerCase(),
				r.date.toLowerCase(),
				r.authors.join('').toLowerCase(),
				// authorsText: r.authorsText.toLowerCase(),
			]
			let rflat = rf.join('')//JSON.stringify(rf)
			if(rflat.includes(keyword.toLowerCase())){
				// console.log(r)
				resultsFilter.push(r)
			}
		}
		if(resultsFilter.length > 0){
			filterStatus(resultsFilter.length + ' results found.')
			results = resultsFilter.slice()
			addResults()
			// lazyLoadInstance.update();
		}else{
			filterStatus('No results found.')
			// document.getElementById('results').innerHTML = '<p> No results found.</p>'
		}
	}

	function filterStatus(msg){
		div.filter.status.innerHTML = msg
	}

	function filterClear(){
		div.filter.input.value = ''
		div.filter.clear.style.display = 'none'
		resultsFilter = []
		filterStatus('')
		results = resultsAll.slice()
		initResults()
	}

	function initResults(){
		document.getElementById('results').innerHTML = ''
		offset = 0
		count = 20
		addResults()
	}

	function addResults(){
		// div.loading.style.display = 'block'
		// console.log(results[0])
		let lc = offset+count
		if(lc > results.length){
			lc = results.length
		}
		for(let i = offset; i < lc; i++){
			let r = results[i]
			parseResult(r)
		}
		lazyLoadInstance.update()
		// div.loading.style.display = 'none'
		favsInit()
	}

	function parseResult(r){
		let v = {}
		v.id = r.Id
		v.link = r.link
		v.title = r.title
		v.date = r.date
		v.authors = r.authortext
		v.mediaserver = 'https://ba14ns21403-sec1.fhnw.ch/mediasrv/'
		v.path = r.poster.uri.replace('mediaserver:', '')
		v.details = 'https://mediathek.hgk.fhnw.ch/amp/detail/' + r.Id
		v.poster =  v.mediaserver + v.path + '/resize/size320x180/formatJPEG'
		v.video = v.mediaserver + v.path.replace('timeshot$$3', 'web/master/')
		v.vidPlay = `vidPlay(this, \'${v.poster}\',\'${v.video}\')`
		v.cursor = `cursor:pointer;`
		if(!r.media.hasOwnProperty('video')){
			v.vidPlay = ``
			v.cursor = ``
		}
		/*
			div class="lazy vid-poster" style="width:100%;height:auto;background-image:url(${v.poster});background-size:cover;"></div>
			<video playsinline webkit-playsinline controls data-poster="${v.poster}" preload="none">
			  <source src="${v.video}" type="video/mp4">
			  Your browser does not support the video tag.
			</video><br>

		 */

		let html = `
		<div id="${v.id}" class="vid">

			<div class="vid-holder" style="width:100%;background:#000;">
			<img class="lazy" src="${v.poster}" style="width:100%;${v.cursor}" onclick="${v.vidPlay}" title="Click to play">
			</div>

			<a class="fav link" onclick="favsToggle(\'${v.id}\')" title="click to save in favorites">
			<svg id="fav-${v.id}" class="fav-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
			</a>

			<a class="link" href="${v.details}" target="_blank"  title="Click for more details">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-database"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>
			</a>
			<div class="info">
				<i>${v.title}</i><br>
				${v.authors}<br>
				${v.date}<br>
			</div>

		</div>
		`
		document.getElementById('results').innerHTML += html
		return false;
	}



	function shuffleArray(array) {
		for (let i = array.length - 1; i > 0; i--) {
			const j = Math.floor(Math.random() * (i + 1));
			[array[i], array[j]] = [array[j], array[i]];
		}
	}

	function showCredits(elm){
		elm.innerHTML = `
		All copyrights belong to their respective authors.<br>
		CODE + DESIGN → <a href="https://teddavis.org" target="_blank">teddavis.org</a>`
	}

	function favsInit(){
		 let tempFavs = localStorage.getItem('favs')
		 if(tempFavs != undefined){
		 	favs = JSON.parse(tempFavs)
		 }

		let favItems = document.querySelectorAll('.fav-svg').forEach(function(elm){
			elm.style.fill = 'none'
		})

	 	for(let f of favs){
		 	let favItem = document.getElementById('fav-'+f)
		 	if(favItem != undefined){
			 	document.getElementById('fav-'+f).style.fill = '#fff'
		 	}
		 }
	}

	function favsToggle(id){
		if(favs.indexOf(id) == -1){
			favs.push(id)
		}else{
			favs.splice(favs.indexOf(id), 1)
		}
		favsSync()
	}

	function favsSync(){
		localStorage.setItem('favs', JSON.stringify(favs))
		favsInit()
		// console.log(localStorage.getItem('favs'))
	}

	function vidPlay(elm, poster, vid){
		let vidHTML = `
		<video playsinline webkit-playsinline controls poster="${poster}">
		  <source src="${vid}" type="video/mp4">
		  Your browser does not support the video tag.
		</video>`
		let par = elm.parentNode
		par.innerHTML = vidHTML
		par.querySelector('video').play()
	}

</script>
</body>
</html>